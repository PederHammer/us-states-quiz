<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>US States Map Quiz</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f4f4;
      display: flex;
      justify-content: center;
    }
    .wrapper {
      padding: 20px;
    }
    h1 {
      margin-top: 0;
      font-size: 1.8rem;
    }
    #map-container {
      position: relative;
      display: inline-block;
      border: 1px solid #ccc;
      background: #fff;
      line-height: 0;
    }
    #us-map {
      display: block;
    }
    #overlay {
      position: absolute;
      left: 0;
      top: 0;
      pointer-events: auto;
    }
    .info {
      margin-top: 12px;
    }
    #current-state {
      font-weight: bold;
      font-size: 1.2rem;
    }
    #feedback {
      margin-top: 6px;
      min-height: 1.5em;
    }
    #progress {
      margin-top: 6px;
      font-size: 0.95rem;
      color: #444;
    }
    .note {
      margin-top: 18px;
      font-size: 0.85rem;
      color: #666;
    }
  </style>
</head>
<body>
<div class="wrapper">
  <h1>US States Map Quiz</h1>
  <p>
    Klik på kortet for at placere den stat, der står nedenfor. En runde består af 10 tilfældige stater.
  </p>

  <div id="map-container">
    <img id="us-map" src="us_map.png" alt="Map of the United States">
    <canvas id="overlay"></canvas>
  </div>

  <div class="info">
    <div id="current-state">Indlæser kort...</div>
    <div id="feedback"></div>
    <div id="progress"></div>
  </div>

  <p class="note">
    Tip: Brug det som træningsværktøj. En runde ad gangen, og læg mærke til de stater,
    du oftest rammer forkert.
  </p>
</div>


 <script>
  const STATES = [
    ["AL", "Alabama"], ["AK", "Alaska"], ["AZ", "Arizona"], ["AR", "Arkansas"],
    ["CA", "California"], ["CO", "Colorado"], ["CT", "Connecticut"], ["DE", "Delaware"],
    ["FL", "Florida"], ["GA", "Georgia"], ["HI", "Hawaii"], ["ID", "Idaho"],
    ["IL", "Illinois"], ["IN", "Indiana"], ["IA", "Iowa"], ["KS", "Kansas"],
    ["KY", "Kentucky"], ["LA", "Louisiana"], ["ME", "Maine"], ["MD", "Maryland"],
    ["MA", "Massachusetts"], ["MI", "Michigan"], ["MN", "Minnesota"], ["MS", "Mississippi"],
    ["MO", "Missouri"], ["MT", "Montana"], ["NE", "Nebraska"], ["NV", "Nevada"],
    ["NH", "New Hampshire"], ["NJ", "New Jersey"], ["NM", "New Mexico"], ["NY", "New York"],
    ["NC", "North Carolina"], ["ND", "North Dakota"], ["OH", "Ohio"], ["OK", "Oklahoma"],
    ["OR", "Oregon"], ["PA", "Pennsylvania"], ["RI", "Rhode Island"],
    ["SC", "South Carolina"], ["SD", "South Dakota"], ["TN", "Tennessee"],
    ["TX", "Texas"], ["UT", "Utah"], ["VT", "Vermont"], ["VA", "Virginia"],
    ["WA", "Washington"], ["WV", "West Virginia"], ["WI", "Wisconsin"], ["WY", "Wyoming"],
  ];

  const STATE_NAMES = Object.fromEntries(STATES);

  const STATE_POS_NORM = {
    "AL": { "x": 0.6837431693989071, "y": 0.6490832114925842 },
    "AK": { "x": 0.20013661202185792, "y": 0.8098730563444883 },
    "AZ": { "x": 0.24203096539162114, "y": 0.5856135358931484 },
    "AR": { "x": 0.5817395264116576, "y": 0.5898448475997774 },
    "CA": { "x": 0.11999089253187614, "y": 0.4741889942852499 },
    "CO": { "x": 0.3558743169398907, "y": 0.44739068680993255 },
    "CT": { "x": 0.8822859744990893, "y": 0.29224259090020055 },
    "DE": { "x": 0.8549635701275046, "y": 0.40084625803701296 },
    "FL": { "x": 0.7848360655737705, "y": 0.7774329999269989 },
    "GA": { "x": 0.7429417122040073, "y": 0.634978839137154 },
    "HI": { "x": 0.35860655737704916, "y": 0.8578279223529509 },
    "ID": { "x": 0.23383424408014572, "y": 0.23723553871402284 },
    "IL": { "x": 0.6272768670309654, "y": 0.4191819420990722 },
    "IN": { "x": 0.6764571948998178, "y": 0.41636106762798614 },
    "IA": { "x": 0.5562386156648452, "y": 0.3585331409707224 },
    "KS": { "x": 0.48064663023679416, "y": 0.47842030599187896 },
    "KY": { "x": 0.7028688524590164, "y": 0.482651617698508 },
    "LA": { "x": 0.5862932604735883, "y": 0.7196050732697351 },
    "ME": { "x": 0.9168943533697632, "y": 0.15260930458144173 },
    "MD": { "x": 0.8276411657559198, "y": 0.3937940718592979 },
    "MA": { "x": 0.8950364298724954, "y": 0.2598025344827111 },
    "MI": { "x": 0.6755464480874317, "y": 0.2330042270073938 },
    "MN": { "x": 0.5489526411657559, "y": 0.21043723123870547 },
    "MS": { "x": 0.6327413479052824, "y": 0.6589562721413853 },
    "MO": { "x": 0.5799180327868853, "y": 0.47842030599187896 },
    "MT": { "x": 0.32126593806921677, "y": 0.17517630035013002 },
    "NE": { "x": 0.4651639344262295, "y": 0.3754583877972386 },
    "NV": { "x": 0.1819216757741348, "y": 0.39097319738821185 },
    "NH": { "x": 0.892304189435337, "y": 0.22172072912304963 },
    "NJ": { "x": 0.8640710382513661, "y": 0.35289139202855035 },
    "NM": { "x": 0.340391621129326, "y": 0.5983074710130355 },
    "NY": { "x": 0.8331056466302368, "y": 0.26403384618934017 },
    "NC": { "x": 0.8094262295081968, "y": 0.5221438602937125 },
    "ND": { "x": 0.4551457194899818, "y": 0.18363892376338814 },
    "OH": { "x": 0.7283697632058288, "y": 0.39097319738821185 },
    "OK": { "x": 0.49339708561020035, "y": 0.5715091635377182 },
    "OR": { "x": 0.14275956284153005, "y": 0.22313116635859265 },
    "PA": { "x": 0.8066939890710383, "y": 0.3430183313797492 },
    "RI": { "x": 0.9005009107468124, "y": 0.28519040472248547 },
    "SC": { "x": 0.7866575591985429, "y": 0.5926657220708634 },
    "SD": { "x": 0.4615209471766849, "y": 0.2739069068381413 },
    "TN": { "x": 0.677367941712204, "y": 0.5489421677690299 },
    "TX": { "x": 0.46971766848816027, "y": 0.705500700914305 },
    "UT": { "x": 0.2611566484517304, "y": 0.4248236910412443 },
    "VT": { "x": 0.869535519125683, "y": 0.2118476684742485 },
    "VA": { "x": 0.8012295081967213, "y": 0.4572637474587337 },
    "WA": { "x": 0.16097449908925318, "y": 0.11734837369286627 },
    "WV": { "x": 0.7675318761384335, "y": 0.4346967516900454 },
    "WI": { "x": 0.613615664845173, "y": 0.2654442834248832 },
    "WY": { "x": 0.340391621129326, "y": 0.31339914943334585 }
  };

  const STATE_FUNFACT = {
  AL: "Navnet kommer fra et creek-ord, ofte tolket som 'rydere af skove'.",
  AK: "Fra aleutisk 'alaxsxaq' - 'det store land'.",
  AZ: "Fra o'odham 'ali sonak' - 'stedet med små kilder'.",
  AR: "Fra fransk navn for quapaw-folket - 'akansa'.",
  CA: "Fra en spansk ridderroman om øen California.",
  CO: "Spansk 'colorado' - 'rødlig'.",
  CT: "Fra algonkinsk 'Quinnehtukqut' - 'ved den lange flod'.",
  DE: "Opkaldt efter Lord De La Warr.",
  FL: "Fra spansk 'La Florida' - 'det blomstrende sted'.",
  GA: "Opkaldt efter kong George II.",
  HI: "Polynesisk navn, ofte tolket som 'den guddommelige hjemstavn'.",
  ID: "Et opdigtet navn, skabt til at lyde indiansk.",
  IL: "Fra 'Illiniwek' - 'menneskene'.",
  IN: "Betyder 'indianernes land'.",
  IA: "Opkaldt efter iowa-folket.",
  KS: "Fra kansa-folket - 'folket fra sydvinden'.",
  KY: "Irokesisk ord for 'eng' eller 'slette'.",
  LA: "Opkaldt efter Ludvig 14. af Frankrig.",
  ME: "Sandsynligvis 'fastlandet' i fransk/engelsk brug.",
  MD: "Opkaldt efter dronning Henrietta Maria.",
  MA: "Fra massachusett-folket - 'den store bakke'.",
  MI: "Fra ojibwe 'mishigami' - 'det store vand'.",
  MN: "Fra dakota 'Mnisota' - 'uklart/blåligt vand'.",
  MS: "Fra ojibwe 'misi-ziibi' - 'den store flod'.",
  MO: "Fra missouri-folket - 'folk med udhulede kanoer'.",
  MT: "Fra spansk 'montana' - 'bjergland'.",
  NE: "Fra oto 'ni brasge' - 'fladt vand'.",
  NV: "Spansk 'nevada' - 'sneklædt'.",
  NH: "Opkaldt efter Hampshire i England.",
  NJ: "Opkaldt efter øen Jersey.",
  NM: "Fra spansk 'Nuevo Mexico'.",
  NY: "Opkaldt efter hertugen af York.",
  NC: "Opkaldt efter kong Charles 1.",
  ND: "Fra dakota-folket - 'allierede'.",
  OH: "Irokesisk ord for 'den smukke flod'.",
  OK: "Fra choctaw 'okla humma' - 'røde mennesker'.",
  OR: "Muligvis fra fransk 'ouragan' - om Columbia-floden.",
  PA: "'Penns skovland' - efter William Penn.",
  RI: "Fra nederlandsk 'Roodt Eylandt' - 'den røde ø'.",
  SC: "Opkaldt efter kong Charles 1.",
  SD: "Opkaldt efter dakota-folket - 'allierede'.",
  TN: "Fra cherokee 'Tanasi'.",
  TX: "Fra caddo 'taysha' - 'venner'.",
  UT: "Opkaldt efter ute-folket - 'folket fra bjergene'.",
  VT: "Fransk 'vert mont' - 'grønt bjerg'.",
  VA: "Opkaldt efter Elizabeth 1., 'The Virgin Queen'.",
  WA: "Opkaldt efter George Washington.",
  WV: "Den vestlige del af Virginia.",
  WI: "Fra ojibwe, muligvis 'rød sten'.",
  WY: "Fra lenape - 'ved den store eng'."
};



  // Tolerancer
  const DEFAULT_TOL = 0.06;
  const SMALL_STATE_TOL = 0.03;
  const STATE_TOL = {
    RI: SMALL_STATE_TOL,
    DE: SMALL_STATE_TOL,
    CT: SMALL_STATE_TOL,
    NJ: SMALL_STATE_TOL,
    MD: SMALL_STATE_TOL,
    MA: SMALL_STATE_TOL,
    VT: SMALL_STATE_TOL,
    NH: SMALL_STATE_TOL,
    HI: SMALL_STATE_TOL
  };
  function getTolerance(abbr) {
    return STATE_TOL[abbr] || DEFAULT_TOL;
  }

  const POSITIVE_FEEDBACK = [
    "Stærkt gættet.",
    "Lige i skabet.",
    "Det sad lige hvor det skulle.",
    "Yes, den sad der.",
    "Godt set."
  ];

  const NEGATIVE_FEEDBACK = [
    "Tæt på er også læring.",
    "Den var svær - nu ved du det til næste gang.",
    "God træning, selv om den var forkert.",
    "Det er sådan her man lærer kortet at kende.",
    "Fair nok, den snyder mange."
  ];

  const img = document.getElementById("us-map");
  const canvas = document.getElementById("overlay");
  const currentStateEl = document.getElementById("current-state");
  const feedbackEl = document.getElementById("feedback");
   
   feedbackEl.style.whiteSpace = "pre-line";

  const progressEl = document.getElementById("progress");

  let ctx;
  let mapLoaded = false;

  let roundNumber = 1;
  let roundStates = [];
  let roundIndex = 0;
  let roundCorrect = 0;
  let roundQuestions = 0;
  let currentTarget = null;
  let waiting = false;

  function shuffle(arr) {
    const copy = arr.slice();
    for (let i = copy.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [copy[i], copy[j]] = [copy[j], copy[i]];
    }
    return copy;
  }

  function startRound() {
    const allAbbr = STATES.map(([abbr]) => abbr);
    const shuffled = shuffle(allAbbr);
    roundStates = shuffled.slice(0, 10);
    roundIndex = 0;
    roundCorrect = 0;
    roundQuestions = 0;
    document.title = `US States Quiz - Runde ${roundNumber}`;
    feedbackEl.textContent = "";
    clearOverlay();
    startNextQuestion();
  }

  function startNextQuestion() {
    if (roundIndex >= roundStates.length) {
      endRound();
      return;
    }
    currentTarget = roundStates[roundIndex];
    roundIndex += 1;

    const name = STATE_NAMES[currentTarget] || currentTarget;
    currentStateEl.textContent =
      `Runde ${roundNumber}: Klik på ${name} (${currentTarget}).`;
    feedbackEl.textContent = "";
    updateProgress();
  }

  function endRound() {
    const total = roundQuestions;
    const correct = roundCorrect;
    let msg = `Runde ${roundNumber} er færdig.\n\nDu ramte ${correct} ud af ${total} rigtigt.`;
    }
    msg += `\n\nVil du tage en runde mere?`;

    const again = window.confirm(msg);
    if (again) {
      roundNumber += 1;
      startRound();
    } else {
      currentStateEl.textContent = "Tak for spillet.";
      feedbackEl.textContent = "";
      progressEl.textContent = "";
      currentTarget = null;
    }
  }

  function updateProgress() {
    progressEl.textContent =
      `Spørgsmål i denne runde: ${roundQuestions} af ${roundStates.length} – korrekte: ${roundCorrect}`;
  }

  function clearOverlay() {
    if (!ctx) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  function drawMarker(abbr, color = "black") {
    const pos = STATE_POS_NORM[abbr];
    if (!ctx || !pos) return;
    const x = pos.x * canvas.width;
    const y = pos.y * canvas.height;
    const r = Math.max(6, Math.min(canvas.width, canvas.height) * 0.012);

    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.fillStyle = "rgba(255,255,255,0.7)";
    ctx.fill();
    ctx.lineWidth = 2;
    ctx.strokeStyle = color;
    ctx.stroke();
  }

  function findClickedState(xPx, yPx) {
    const nx = xPx / canvas.width;
    const ny = yPx / canvas.height;
    let bestAbbr = null;
    let bestDist2 = Infinity;

    for (const [abbr, pos] of Object.entries(STATE_POS_NORM)) {
      const dx = nx - pos.x;
      const dy = ny - pos.y;
      const d2 = dx * dx + dy * dy;
      if (d2 < bestDist2) {
        bestDist2 = d2;
        bestAbbr = abbr;
      }
    }
    return bestAbbr;
  }

function handleQuizClick(xPx, yPx) {
  if (!currentTarget || waiting) return;

  waiting = true;

  const normX = xPx / canvas.width;
  const normY = yPx / canvas.height;

  const clickedAbbr = findClickedState(xPx, yPx);
  const clickedName = STATE_NAMES[clickedAbbr] || clickedAbbr;
  const targetName = STATE_NAMES[currentTarget] || currentTarget;
  const funfact = STATE_FUNFACT[currentTarget] || "";

  roundQuestions += 1;

  const targetPos = STATE_POS_NORM[currentTarget];
  let inRange = false;

  if (targetPos) {
    const dxT = normX - targetPos.x;
    const dyT = normY - targetPos.y;
    const dist = Math.sqrt(dxT * dxT + dyT * dyT);
    const tol = getTolerance(currentTarget);
    inRange = dist <= tol;
  }

  currentStateEl.textContent = `Du klikkede på ${clickedName} (${clickedAbbr}).`;

  if (clickedAbbr === currentTarget && inRange) {
    roundCorrect += 1;   // ← denne linje er den vigtige
    const prefix =
      POSITIVE_FEEDBACK[Math.floor(Math.random() * POSITIVE_FEEDBACK.length)];
    feedbackEl.textContent =
      `${prefix} Det var rigtigt - ${targetName} (${currentTarget}).`;
  } else {
    const prefix =
      NEGATIVE_FEEDBACK[Math.floor(Math.random() * NEGATIVE_FEEDBACK.length)];
    feedbackEl.textContent =
      `${prefix} Den rigtige var ${targetName} (${currentTarget}).`;
  }

  if (funfact) {
    feedbackEl.textContent += `\nNavne-oprindelse: ${funfact}`;
  }

  drawMarker(currentTarget, "black");
  updateProgress();

  setTimeout(() => {
    waiting = false;
    startNextQuestion();
  }, 9000);
}


  function handleClick(event) {
    if (!mapLoaded) return;
    const rect = canvas.getBoundingClientRect();
    const x = event.clientX - rect.left;
    const y = event.clientY - rect.top;
    handleQuizClick(x, y);
  }

  img.addEventListener("load", () => {
    const w = img.naturalWidth;
    const h = img.naturalHeight;

    img.style.width = w + "px";
    img.style.height = "auto";

    canvas.width = w;
    canvas.height = h;
    canvas.style.width = w + "px";
    canvas.style.height = h + "px";

    ctx = canvas.getContext("2d");
    mapLoaded = true;

    currentStateEl.textContent = "Kort indlæst. Klar til første runde.";
    startRound();
  });

  canvas.addEventListener("click", handleClick);

  if (img.complete && img.naturalWidth > 0) {
    const ev = new Event("load");
    img.dispatchEvent(ev);
  }
</script>

</body>
</html>
